# 提纲 版本1

## 标题

### 支持Rust语言的源代码级操作系统调试工具

#### 摘要

- **段落1**：介绍调试工具的主要功能和目标，即为Rust编写的操作系统提供源代码级的调试支持，包括跨特权级调试和动态跟踪调试。**参考**：项目文档摘要部分。
- **段落2**：简述工具的主要特点，如基于QEMU和GDB的实现，eBPF技术的集成，以及远程开发环境的构建。**参考**：项目文档摘要部分和1.2工作内容概要。
- **段落3**：强调该工具旨在降低Rust操作系统开发的难度，提高开发效率。**参考**：项目文档摘要部分。

**关键词**：Rust, 操作系统, 调试工具, QEMU, GDB, eBPF, VSCode

#### 1. 引言

##### 1.1 研究背景和意义

- **段落1**：描述操作系统开发的复杂性，特别是在Rust语言环境下的特殊挑战。**参考**：项目文档1.1研究背景和意义。
- **段落2**：讨论现有工具在Rust操作系统开发中的不足，突出新工具的研发动机。**参考**：项目文档1.1研究背景和意义。

##### 1.2 工作内容概要

- **段落1**：概述本工作的主要贡献，包括跨特权级调试、动态跟踪调试和远程开发环境支持。**参考**：项目文档1.2工作内容概要。

##### 1.3 本文组织架构

- **段落1**：简要介绍文章的结构安排。**参考**：项目文档1.3本文组织架构。

#### 2. 工具设计与实现

##### 2.1 基于GDB的内核态与用户态代码联合断点调试

- **段落1**：介绍跨特权级调试的需求和挑战。**参考**：项目文档2.1概述。
- **段落2**：详细描述断点组切换机制的设计与实现，包括技术细节和实现难点。**参考**：项目文档2.1基于Debug Adapter的调试工具设计与实现。
- **段落3**：讨论如何通过修改GDB和VSCode的交互，实现断点组的自动切换。**参考**：项目文档2.1解决内核态用户态的GDB断点冲突。

##### 2.2 基于eBPF的动态跟踪调试

- **段落1**：概述eBPF技术在操作系统调试中的应用背景。**参考**：项目文档3.1概述。
- **段落2**：详细说明eBPF技术集成到调试工具中的过程，包括eBPF模块的移植和功能实现。**参考**：项目文档3.2在rCore-Tutorial-v3上实现eBPF功能。

##### 2.3 远程开发环境的构建

- **段落1**：介绍远程开发环境的需求和设计目标。**参考**：项目文档4.1概述。
- **段落2**：详细描述如何基于VSCode插件构建远程开发环境，包括技术细节和用户界面设计。**参考**：项目文档4.3调试适配器和VSCode、GDB的交互。

#### 3. 应用实例

- **段落1-3**：分别描述三个实际的应用示例，包括跨特权级调试、动态跟踪调试和远程开发环境使用示例，每个示例详细介绍操作步骤和调试效果。**参考**：项目文档5应用实例。

#### 4. 实验评估

- **段落1**：介绍实验设置，包括测试的调试功能和性能指标。**参考**：项目文档4.3.4实际硬件的支持（部分完成）。
- **段落2**：展示实验结果，包括功能测试和性能评估，与现有工具对比。**参考**：项目文档各节中的实验数据和用户反馈。

#### 5. 相关工作

- **段落1**：回顾与本工具相关的其他工作，包括其他调试工具和技术的简要评述。**参考**：根据实际研究背景，结合已有文献进行总结。

#### 6. 总结与展望

- **段落1**：总结本工作的主要贡献和成果。**参考**：项目文档的总结部分。
- **段落2**：讨论未来可能的改进方向和研究工作。**参考**：项目文档的展望部分。

#### 7. 软硬件结合的异常跟踪机制

##### 7.1 跟踪异常的需求

- **段落1**：介绍在现有的操作系统调试工具中，如何跟踪系统调用（syscall）的方法，以及这些方法无法有效跟踪异常（exception）的局限性。**参考**：无，这是一个新提出的gap。

##### 7.2 软硬件结合的解决方案

- **段落1**：提出一种新的解决方案，即通过修改虚拟机和真实硬件（例如RISC-V的一个扩展）来实现异常和系统调用的直接跟踪。**参考**：无，这是一个新提出的gap。
- **段落2**：详细描述这个方案的工作原理，即一旦发生异常或系统调用，硬件会直接通知外部调试器。外部调试器收到这个通知后，可以进行断点组切换等操作。**参考**：无，这是一个新提出的gap。

##### 7.3 方案的优势

- **段落1**：阐述这种软硬件结合的方法带来的好处，包括能够彻底解决异常和系统调用跟踪的问题，提高调试工具的覆盖率和准确性。**参考**：无，这是一个新提出的gap。

```
# 提纲 版本2

## 系统调用跟踪

### 利用GDB进行syscall跟踪的传统方法

### 利用VSCode进行自动化的系统调用跟踪

#### VSCode提供的自动化API

#### 特权级切换时自动进行单步

#### 断点组切换

### 展望 - 怎么通过软硬件结合的方法跟踪异常

这个事情是朱毅在泉城的时候跟我说的。他意思是说

## eBPF增强跟踪能力

### 什么是eBPF（eBPF不影响OS的运行状态）用eBPF的好处（更加灵活，缓解编译器调试信息不全带来的种种困扰。GDB就像x光，eBPF就像肠镜）

### 我们用eBPF进行调试的思路（插桩-运行eBPF收集信息-利用串口输出信息）

### 以rCore-Tutorial-v3为例，怎么实现这种跟踪能力

#### 给rCore-Tutorial-v3添加eBPF

##### 模块化了别人的库

##### OS本身的修改

#### 传输调试信息

##### 怎么添加串口输入输出的功能

##### GDB怎么同时把两种调试信息处理清楚

## 一个实际的debug例子，用文本的GDB很难弄清楚，但是用调试器就能快速搞定的

## 引用
```