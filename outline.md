# 提纲

文章解决的核心问题：操作系统代码调试时，特权级切换导致符号表等调试信息丢失进而断点调试失败。（需要确认：内核架构是否有影响，比如宏内核、微内核等）
核心方法：
1、利用断点组缓存不同特权级的断点等调试信息
2、特权级切换检测，以及切换时的调试信息切换
实现部分：
基于vscode插件统一真实硬件和qemu模拟器的调试

## 摘要



## 1 Introduction 概述

操作系统开发者希望用 GDB 同时调试内核和用户态程序。然而，由于 GDB 在设置断点时会修改断点处的内存，但 GDB 只支持当前地址空间的内存查找，一旦设置的断点是另一个地址空间的，GDB就不能设置它。一种情况是pending且无法恢复，另一种情况是错误的。

## 系统调用跟踪

### 利用GDB进行syscall跟踪的传统方法

### 利用VSCode进行自动化的系统调用跟踪

#### VSCode提供的自动化API

#### 特权级切换时自动进行单步

#### 断点组切换

### 展望 - 怎么通过软硬件结合的方法跟踪异常

这个事情是朱毅在泉城的时候跟我说的。他意思是说

## eBPF增强跟踪能力

### 什么是eBPF（eBPF不影响OS的运行状态）用eBPF的好处（更加灵活，缓解编译器调试信息不全带来的种种困扰。GDB就像x光，eBPF就像肠镜）

### 我们用eBPF进行调试的思路（插桩-运行eBPF收集信息-利用串口输出信息）

### 以rCore-Tutorial-v3为例，怎么实现这种跟踪能力

#### 给rCore-Tutorial-v3添加eBPF

##### 模块化了别人的库

##### OS本身的修改

#### 传输调试信息

##### 怎么添加串口输入输出的功能

##### GDB怎么同时把两种调试信息处理清楚

## 一个实际的debug例子，用文本的GDB很难弄清楚，但是用调试器就能快速搞定的

## 引用